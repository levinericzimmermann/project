[configure]
name                    = "10.1"
logging_level           = "info"

[configure.audio]
audio                   = "jack"
midi                    = "jack"
sampling_rate           = 44100
buffer_size             = 512
channel_count           = 4

{% set fade_in                  = 5 %}
{% set fade_out                 = 8 %}
{% set box_count                = 3 %}
{% set string_count             = 3 %}
{% set total_string_count       = string_count * box_count %}

{% for box_index in range(box_count) %}
    {% for pin_index in range(string_count) %}
        {% set string_index = (box_index * string_count) + pin_index %}
        [configure.module.string.{{ string_index }}]
        com_port                = "/dev/ttyACM{{ box_index }}"
        pin_index               = {{ pin_index }}
    {% endfor %}

    # Each box has its own pickup
    [configure.module.audio_input.{{ box_index }}]
    input_channel_index     = {{ box_index }}
    fade_in_duration        = {{ fade_in }}
    fade_out_duration       = {{ fade_out }}

    [configure.module.value.audio_input_{{ box_index }}_child_decibel]
    # We have a very quiet signal
    value                   = 50

    [configure.module.compressor.{{ box_index }}]
    audio_input             = "audio_input.{{ box_index }}"
{% endfor %}

[configure.module.aeolian_harp.0]
{% for box_index in range(box_count) %}
    {% for pin_index in range(string_count) %}
        {% set string_index = (box_index * string_count) + pin_index %}
        audio_input_{{ string_index }}           = "string.{{ string_index }}"
    {% endfor %}
    audio_input_{{ total_string_count + box_index }} = "compressor.{{ box_index }}"
{% endfor %}

    [configure.module.aeolian_harp.0.audio_input_index_to_pyo_object_index]
    {% for box_index in range(box_count) %}
    {{ box_index + total_string_count }} = {{ box_index }}
    {% endfor %}

[configure.module.mixer.strings]
{% for box_index in range(box_count) %}
    audio_input_{{ box_index }}          = "aeolian_harp.0.{{ box_index }}"
{% endfor %}
{% for box_index in range(box_count) %}
    [configure.module.mixer.strings.default_dict.audio_input_{{ box_index }}_channel_mapping]
    0 = [{{ box_index }}]
{% endfor %}

[configure.module.mixer.strings.channel_mapping]
{% for box_index in range(box_count) %}
    {{ box_index }}          = {{ box_index }}
{% endfor %}

[configure.module.butterworth_highpass_filter.strings]
audio_input             = "mixer.strings"

[configure.module.value.butterworth_highpass_filter_strings_child_frequency]
value                   = 100

[configure.module.butterworth_lowpass_filter.strings]
audio_input             = "butterworth_highpass_filter.strings"

[configure.module.value.butterworth_lowpass_filter_strings_child_frequency]
value                   = 17000

[configure.module.average.strings]
audio_input             = "butterworth_lowpass_filter.strings"

[configure.module.value.average_strings_child_size]
# Higher value -> less noise, but also less clear signal
value                   = 25

[configure.module.mixer.pre_master]
audio_input_0           = "average.strings"

[configure.module.mixer.pre_master.channel_mapping]
{% for box_index in range(box_count) %}
    {{ box_index }}          = {{ box_index }}
{% endfor %}

[configure.module.value.mixer_pre_master_child_decibel]
value                   = -3

[configure.module.mixer.master]
send_to_physical_output = true
audio_input_0           = "mixer.pre_master"

[configure.module.mixer.master.channel_mapping]
{% for box_index in range(box_count) %}
    {{ box_index }}          = {{ box_index }}
{% endfor %}

[configure.module.value.mixer_master_child_decibel]
value                   = 14
